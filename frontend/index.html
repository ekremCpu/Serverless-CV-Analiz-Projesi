<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI CV Analiz - Puanlƒ± Sistem</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --primary: #4f46e5; --accent: #f43f5e; --bg: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%); }
        body { font-family: 'Inter', sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; min-height: 100vh; margin: 0; }
        
        .card { background: white; width: 100%; max-width: 900px; border-radius: 24px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1e293b; margin-bottom: 10px; }
        h1 span { color: var(--primary); }
        .subtitle { text-align: center; color: #64748b; margin-bottom: 30px; font-size: 0.95rem; }
        
        /* Kriter kutusu silindiƒüi i√ßin CSS'i de temizlendi */

        .drop-zone { border: 2px dashed #cbd5e1; border-radius: 16px; padding: 40px; text-align: center; cursor: pointer; transition: 0.3s; background: #f8fafc; margin-bottom: 25px;}
        .drop-zone:hover { border-color: var(--primary); background: #eef2ff; }
        .drop-zone i { font-size: 40px; color: #94a3b8; margin-bottom: 15px; display: block;}
        .drop-zone.active i { color: #22c55e; }
        .drop-text { font-size: 1.1rem; color: #475569; font-weight: 500; }

        .btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; transition: 0.2s; font-size: 1rem; display: flex; justify-content: center; align-items: center; gap: 10px;}
        .btn-analyze { background: linear-gradient(to right, #4f46e5, #4338ca); color: white; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2); }
        .btn-analyze:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4); }
        .btn-history { background: white; border: 2px solid #e2e8f0; color: #475569; margin-top: 20px; }
        .btn-history:hover { background: #f8fafc; border-color: #cbd5e1; }
        
        /* SONU√á ALANI TASARIMI */
        #result { display: none; margin-top: 30px; animation: fadeIn 0.5s; }
        
        .score-card { 
            display: flex; align-items: center; gap: 20px; 
            background: #f0fdf4; border: 1px solid #bbf7d0; 
            padding: 25px; border-radius: 16px; margin-bottom: 20px;
        }
        
        .score-circle {
            width: 90px; height: 90px; border-radius: 50%;
            background: white; border: 6px solid #22c55e;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.8rem; font-weight: 800; color: #15803d;
            box-shadow: 0 4px 10px rgba(34, 197, 94, 0.2);
            flex-shrink: 0;
        }

        .summary-text { color: #14532d; font-size: 1.05rem; line-height: 1.6; }

        .questions-box { background: #fff1f2; border: 1px solid #fecdd3; border-radius: 16px; padding: 25px; }
        .questions-box h4 { margin: 0 0 15px 0; color: #9f1239; display: flex; align-items: center; gap: 10px; font-size: 1.1rem;}
        .questions-box ul { margin: 0; padding-left: 20px; color: #881337; }
        .questions-box li { margin-bottom: 10px; line-height: 1.5; }

        .loader { width: 24px; height: 24px; border: 3px solid #fff; border-bottom-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Tablo */
        table { width: 100%; margin-top: 15px; border-collapse: collapse; table-layout: fixed; }
        th, td { padding: 14px; text-align: left; border-bottom: 1px solid #f1f5f9; font-size: 0.95rem; word-wrap: break-word;}
        th { color: #64748b; font-weight: 600; background-color: #f8fafc; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 0.5px; }
        tr:hover { background-color: #fcfcfc; }
        
        /* S√ºtun Geni≈ülikleri */
        th:nth-child(1) { width: 18%; } /* Tarih */
        th:nth-child(2) { width: 22%; } /* Dosya Adƒ± */
        th:nth-child(3) { width: 10%; text-align: center; } /* Puan */
        td:nth-child(3) { text-align: center; }
        th:nth-child(4) { width: 50%; } /* √ñzet */

    </style>
</head>
<body>

<div class="card">
    <h1>‚òÅÔ∏è AI CV <span>Puanlama</span></h1>
    <div class="subtitle">Yapay zeka destekli teknik analiz ve m√ºlakat asistanƒ±</div>

    <div class="drop-zone" id="dropZone" onclick="document.getElementById('cvFile').click()">
        <i class="fa-solid fa-cloud-arrow-up" id="uploadIcon"></i>
        <div class="drop-text" id="fileName">CV Y√ºklemek ƒ∞√ßin Tƒ±klayƒ±n veya S√ºr√ºkleyin (PDF)</div>
    </div>
    <input type="file" id="cvFile" accept="application/pdf" style="display: none;">

    <button class="btn btn-analyze" onclick="islemYap('analyze')">
        <span id="btnText">Analiz Et ve Puanla üöÄ</span>
        <div class="loader" id="spinner"></div>
    </button>

    <div id="result">
        <div class="score-card" id="scoreCard">
            <div class="score-circle" id="scoreValue">0</div>
            <div class="summary-text" id="summaryText">Analiz yapƒ±lƒ±yor...</div>
        </div>

        <div class="questions-box">
            <h4><i class="fa-solid fa-clipboard-question"></i> Adaya Sorulmasƒ± Gerekenler</h4>
            <ul id="questionsList"></ul>
        </div>
    </div>

    <button class="btn btn-history" onclick="islemYap('get_history')">
        <i class="fa-solid fa-clock-rotate-left"></i> Ge√ßmi≈ü Sonu√ßlar
    </button>
    <div id="historySection" style="display:none; margin-top:20px;">
        <table id="historyTable">
            <thead><tr><th>Tarih</th><th>Dosya Adƒ±</th><th>Puan</th><th>√ñzet</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    // --- LAMBDA URL'Nƒ∞ BURAYA YAZ ---
    const awsUrl ="https://idvvytg6wdhhdpex72hta3mayq0hlxur.lambda-url.us-east-1.on.aws/";
    // --------------------------------

    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('cvFile');

    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.borderColor = '#4f46e5'; dropZone.style.background = '#eef2ff'; });
    dropZone.addEventListener('dragleave', () => { dropZone.style.borderColor = '#cbd5e1'; dropZone.style.background = '#f8fafc'; });
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        fileInput.files = e.dataTransfer.files;
        updateFile();
        dropZone.style.background = '#f8fafc';
    });
    fileInput.addEventListener('change', updateFile);

    function updateFile() {
        if(fileInput.files[0]) {
            document.getElementById('fileName').innerHTML = `<span style="color:#4f46e5; font-weight:bold;">${fileInput.files[0].name}</span> dosyasƒ± se√ßildi ‚úÖ`;
            dropZone.classList.add('active');
            dropZone.style.borderColor = '#22c55e';
        }
    }

    async function islemYap(action) {
        const btnText = document.getElementById("btnText");
        const spinner = document.getElementById("spinner");
        const resultDiv = document.getElementById("result");

        if(action === 'analyze') {
            if(!fileInput.files[0]) { alert("L√ºtfen CV se√ßin!"); return; }
            btnText.style.display = "none";
            spinner.style.display = "block";
            resultDiv.style.display = "none";
        }

        let payload = { action: action };

        if (action === 'analyze') {
            const reader = new FileReader();
            reader.readAsDataURL(fileInput.files[0]);
            reader.onload = async function() {
                payload.file_data = reader.result.split(',')[1];
                payload.file_name = fileInput.files[0].name;
                // DEƒûƒ∞≈ûƒ∞KLƒ∞K BURADA:
                // Kullanƒ±cƒ±dan almak yerine arka planda sabit bir kriter g√∂nderiyoruz.
                payload.criteria = "En az 2 yƒ±l deneyimli, C# bilen ve ƒ∞ngilizcesi iyi olan m√ºhendis."; 
                
                gonder(payload);
            }
        } else {
            gonder(payload);
        }
    }

    async function gonder(payload) {
        try {
            const response = await fetch(awsUrl, {
                method: "POST", headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });
            const data = await response.json();
            
            document.getElementById("btnText").style.display = "block";
            document.getElementById("spinner").style.display = "none";

            if (!response.ok || data.error) {
                alert("Hata: " + (data.error || "Bilinmiyor"));
                return;
            }

            if (payload.action === 'analyze') {
                const aiData = data.analysis; 
                document.getElementById("result").style.display = "block";
                
                const scoreDiv = document.getElementById("scoreValue");
                scoreDiv.innerText = aiData.uyumluluk_puani;
                
                if(aiData.uyumluluk_puani >= 70) scoreDiv.style.borderColor = "#22c55e"; 
                else if(aiData.uyumluluk_puani >= 50) scoreDiv.style.borderColor = "#f59e0b"; 
                else scoreDiv.style.borderColor = "#ef4444"; 

                document.getElementById("summaryText").innerText = aiData.ozet;

                const list = document.getElementById("questionsList");
                list.innerHTML = "";
                aiData.mulakat_sorulari.forEach(q => {
                    list.innerHTML += `<li>${q}</li>`;
                });
                
                islemYap('get_history'); 
            } else {
                const tbody = document.querySelector("#historyTable tbody");
                tbody.innerHTML = "";
                document.getElementById("historySection").style.display = "block";
                if(data.history) {
                    data.history.forEach(item => {
                        let puanClass = item.Puan >= 70 ? "#dcfce7" : (item.Puan >= 50 ? "#fef3c7" : "#fee2e2");
                        let puanColor = item.Puan >= 70 ? "#166534" : (item.Puan >= 50 ? "#92400e" : "#991b1b");
                        let dosyaAdi = item.Dosya || "-";

                        tbody.innerHTML += `<tr>
                            <td>${item.Tarih}</td>
                            <td style="font-weight:600; color:#334155;">${dosyaAdi}</td>
                            <td><span style="background:${puanClass}; color:${puanColor}; padding:6px 10px; border-radius:8px; font-weight:bold;">${item.Puan}</span></td>
                            <td style="font-size:0.9rem; color:#475569;">${item.Ozet}</td>
                        </tr>`;
                    });
                }
            }
        } catch (e) {
            alert("Baƒülantƒ± Hatasƒ±: " + e);
            document.getElementById("btnText").style.display = "block";
            document.getElementById("spinner").style.display = "none";
        }
    }
</script>

</body>
</html>